<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles/style.css">
  <title>Calculator</title>
</head>
<body>
  
<div class="container">

  <div class="calc">
    <div class="display">
      <p></p>
    </div>
    
    <div class="clear">
      <p>AC</p>
    </div>
    
    <div class="plusminus">
      <p>+/-</p>
    </div>
    
    <div class="percentage">
      <p>%</p>
    </div>
    
    <div class="divide operatorButtons">
      <p>/</p>
    </div>

    <div class="seven numPadButtons">
      <p>7</p>
    </div>

    <div class="eight numPadButtons">
      <p>8</p>
    </div>

    <div class="nine numPadButtons">
      <p>9</p>
    </div>

    <div class="multiply operatorButtons">
      <p>x</p>
    </div>

    <div class="four numPadButtons">
      <p>4</p>
    </div>

    <div class="five numPadButtons">
      <p>5</p>
    </div>

    <div class="six numPadButtons">
      <p>6</p>
    </div>
  
    <div class="subtract operatorButtons">
      <p>-</p>
    </div>
    
    <div class="one numPadButtons">
      <p>1</p>
    </div>

    <div class="two numPadButtons">
      <p>2</p>
    </div>

    <div class="three numPadButtons">
      <p>3</p>
    </div>

    <div class="add operatorButtons">
      <p>+</p>
    </div>
    
    <div class="zero numPadButtons">
      <p>0</p>
    </div>

    <div class="decimal numPadButtons">
      <p>.</p>
    </div>

    <div class="equals operatorButtons">
      <p>=</p>
    </div>
  </div>

</div>


<script>

let add = (a, b) => parseFloat(a) + parseFloat(b)
let subtract = (a, b) => parseFloat(b) - parseFloat(a)
let divide = (a, b) => parseFloat(b) / parseFloat(a)
let multiply = (a, b) => parseFloat(a) * parseFloat(b)

let active = undefined;
let memory = undefined;
let operator = undefined;
let total = undefined;

let clear = () => {
  calcDisplay.innerText = ""
  active = undefined;
  operator = undefined;
  memory = undefined;
  total = undefined;
} 
// #TODO - Fix adding multiple leading Zeros issue

let operate = (operator, a, b) => {
  switch (operator) {
    case 'multiply':
      total = multiply(a, b)
      calcDisplay.innerText = total;
      break;
    case 'add':
      total = add(a, b);
      calcDisplay.innerText = total;
      break;
    case 'subtract':
      total = subtract(a, b);
      calcDisplay.innerText = total;
      break;
    case 'divide':
      if (a == 0) {
        clear()
        calcDisplay.innerText = "u no div by 0";        
        break;
      }
      total = divide(a, b);
      calcDisplay.innerText = total;
      break;
    
  }
  // clean up memory
  active = undefined;
  memory = undefined;
  operator = undefined;
  return total;
}


// Targets
let calcDisplay = document.querySelector('.display p')

// Memory
let updateActive = (num) => {
  if (!active && !operator && !memory && total) {
    total = 0
  } else if (active == undefined) {
    active = num;
   } else {
    active = active.concat(num);
   }
  calcDisplay.innerText = active
  return active
 }

let clearAll = document.querySelector('.clear')
  .addEventListener('click', clear)

let btnZero = document.querySelector('.zero')
  .addEventListener('click', () => 
   screen.innerText = updateActive("0"))

let btnOne = document.querySelector('.one')
  .addEventListener('click', () =>
  screen.innerText = updateActive("1"))

let btnTwo = document.querySelector('.two')
  .addEventListener('click', () =>
  screen.innerText = updateActive("2"))

let btnThree = document.querySelector('.three')
  .addEventListener('click', () =>
  screen.innerText = updateActive("3"))

let btnFour = document.querySelector('.four')
  .addEventListener('click', () =>
  screen.innerText = updateActive("4"))

let btnFive = document.querySelector('.five')
  .addEventListener('click', () =>
  screen.innerText = updateActive("5"))

let btnSix = document.querySelector('.six')
  .addEventListener('click', () =>
  screen.innerText = updateActive("6"))

let btnSeven = document.querySelector('.seven')
  .addEventListener('click', () =>
  screen.innerText = updateActive("7"))

let btnEight = document.querySelector('.eight')
  .addEventListener('click', () =>
  screen.innerText = updateActive("8"))

let btnNine = document.querySelector('.nine')
  .addEventListener('click', () =>
  screen.innerText = updateActive("9"))

let btnDecimal = document.querySelector('.decimal')
  .addEventListener('click', () => {
    if (!calcDisplay.innerText.includes('.')) {
    screen.innerText = updateActive(".")
    }
  });

let processOperator = (typeOfOperator) => {
  // Total is displayed, press operator to add total to memory
  if (!active && !memory && total) {
    memory = total;
    operator = typeOfOperator
  // Haven't pressed Equals yet
  } else if (active && memory && operator)  {
    total = operate(typeOfOperator, active, memory)
    active = undefined
    operator = typeOfOperator
    memory = total
  // String of operatores in a row
  } else if (!active && !memory && !operator) {
    total += operate(typeOfOperator, active, memory)
    operator = typeOfOperator
    memory = total
    active = undefined
    // First entry
  } else if (!active && !memory && total === 0) {
    memory = total
    operator = typeOfOperator
    active = undefined
  } else if (!memory)  {
    memory = active;
    operator = typeOfOperator;
    active = undefined
  }
}

let blink = () => {
  calcDisplay.style.visibility = 'hidden';
  setTimeout(() => {
    calcDisplay.style.visibility = 'visible';
  }, 32);
}


// OPERATORS
let operatorDivide = document.querySelector('.divide')
  .addEventListener('click', function () {
    blink();
    total = processOperator(operator)
    operator = 'divide'
});

let operatorMultiply = document.querySelector('.multiply')
  .addEventListener('click', function () {
    blink();
    total = processOperator(operator)
    operator = 'multiply'  
});



let operatorSubtract = document.querySelector('.subtract')
  .addEventListener('click', function () {
    blink();
    if (!operator) {
      operator = 'subtract'
    }
    total = processOperator(operator)
    operator = 'subtract'
});

let operatorAdd = document.querySelector('.add') 
  .addEventListener('click', function() {
    blink();
    if (!operator) {
      operator = 'add'
    }
    if (!memory && !operator) {
      operator = 'add'
      memory = total
    }
    total = processOperator(operator)
    operator = 'add'
});

let operatorEquals = document.querySelector('.equals')
.addEventListener('click', function() {
  if (total == undefined) {
    total = operate(operator, parseInt(active), parseInt(memory))
  } else if (total == 0) {
    total += operate(operator, parseInt(active), parseInt(memory))
  } 
}); 

</script>
</body>
</html>